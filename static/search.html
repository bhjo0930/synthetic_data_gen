<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Peoples - Analysis Dashboard</title>
    
    <!-- Critical CSS inline for performance -->
    <style>
      /* Critical CSS for above-the-fold content */
      :root{--neo-white:#FFFFFF;--neo-black:#000000;--neo-red:#FF0000;--neo-blue:#0000FF;--neo-font-primary:'Arial Black','Helvetica Bold','Impact',sans-serif;--neo-border-thick:4px solid var(--neo-black);--neo-shadow-md:4px 4px 0px var(--neo-black);--neo-shadow-lg:8px 8px 0px var(--neo-black);--neo-space-lg:24px;--neo-space-xl:32px}*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
      
      /* Override for search page header styling */
      .olap-header h1{
        color:white !important;
        background:transparent !important;
        border:none !important;
        box-shadow:none !important;
        transform:none !important;
        font-family:var(--neo-font-primary);
        font-weight:900;
      }
      
      /* Override button styles to ensure Neo-Brutalism appearance */
      .neo-button{
        background:var(--neo-red) !important;
        color:var(--neo-black) !important;
        border:var(--neo-border-thick) !important;
        box-shadow:var(--neo-shadow-md) !important;
        font-family:var(--neo-font-primary) !important;
        font-weight:900 !important;
        font-size:16px !important;
        text-transform:uppercase !important;
        letter-spacing:1px !important;
        padding:12px var(--neo-space-lg) !important;
        cursor:pointer !important;
        border-radius:0 !important;
        transition:none !important;
      }
      
      .neo-button--secondary{
        background:var(--neo-blue) !important;
        color:var(--neo-white) !important;
      }
      
      .neo-button--warning{
        background:#FFFF00 !important;
        color:var(--neo-black) !important;
      }
      
      .neo-button:hover{
        background:var(--neo-black) !important;
        color:var(--neo-red) !important;
        transform:translate(2px,2px) !important;
        box-shadow:2px 2px 0px var(--neo-black) !important;
      }
      
      .neo-button--secondary:hover{
        background:var(--neo-black) !important;
        color:var(--neo-blue) !important;
      }
      
      .neo-button--warning:hover{
        background:var(--neo-black) !important;
        color:#FFFF00 !important;
      }
      
      /* Neo-Brutalism Chart Styling */
      .chart-card {
        min-height: 700px !important;
        max-height: 700px !important;
        height: 700px !important;
        background: var(--neo-white) !important;
        border: var(--neo-border-thick) !important;
        box-shadow: var(--neo-shadow-lg) !important;
        border-radius: 0 !important;
        position: relative !important;
        transform: rotate(-0.3deg) !important;
        contain: layout style paint !important;
      }
      
      .chart-card:nth-child(2n) {
        transform: rotate(0.3deg) !important;
        box-shadow: 6px 6px 0px var(--neo-black) !important;
      }
      
      .chart-card:nth-child(3n) {
        transform: rotate(-0.5deg) !important;
        border-color: var(--neo-red) !important;
      }
      
      .chart-card::before {
        content: '' !important;
        position: absolute !important;
        top: -6px !important;
        left: -6px !important;
        width: 20px !important;
        height: 20px !important;
        background: var(--neo-red) !important;
        border: 2px solid var(--neo-black) !important;
        z-index: 4 !important;
      }
      
      .chart-card:nth-child(2n)::before {
        background: var(--neo-blue) !important;
      }
      
      .chart-card:nth-child(3n)::before {
        background: #FFFF00 !important;
      }
      
      .chart-card h4 {
        font-family: var(--neo-font-primary) !important;
        font-weight: 900 !important;
        font-size: 18px !important;
        color: var(--neo-black) !important;
        text-transform: uppercase !important;
        letter-spacing: 1px !important;
        text-align: center !important;
        margin: 0 0 1rem 0 !important;
        background: var(--neo-black) !important;
        color: var(--neo-white) !important;
        padding: 8px 16px !important;
        border: 2px solid var(--neo-black) !important;
        position: relative !important;
        transform: translateX(-4px) !important;
      }
      
      .chart-card canvas {
        flex: 1 !important;
        width: 100% !important;
        height: auto !important;
        min-height: 600px !important;
        max-height: 650px !important;
        border: 2px solid var(--neo-black) !important;
        background: var(--neo-white) !important;
      }
      
      /* KPI Cards Neo-Brutalism Styling */
      .kpi-card {
        background: var(--neo-white) !important;
        border: var(--neo-border-thick) !important;
        box-shadow: var(--neo-shadow-md) !important;
        border-radius: 0 !important;
        position: relative !important;
        transform: rotate(-1deg) !important;
        contain: layout style paint !important;
      }
      
      .kpi-card:nth-child(2n) {
        transform: rotate(0.8deg) !important;
        background: #F0F0F0 !important;
      }
      
      .kpi-card:nth-child(3n) {
        transform: rotate(-0.5deg) !important;
        border-color: var(--neo-blue) !important;
      }
      
      .kpi-card::before {
        display: none !important;
      }
      
      .kpi-card::after {
        content: '' !important;
        position: absolute !important;
        top: -4px !important;
        right: -4px !important;
        width: 12px !important;
        height: 12px !important;
        background: var(--neo-red) !important;
        border: 2px solid var(--neo-black) !important;
        z-index: 4 !important;
      }
      
      .kpi-card:nth-child(2n)::after {
        background: var(--neo-blue) !important;
      }
      
      .kpi-card:nth-child(3n)::after {
        background: #FFFF00 !important;
      }
      
      .kpi-value {
        font-family: var(--neo-font-primary) !important;
        font-weight: 900 !important;
        font-size: 2.5rem !important;
        color: var(--neo-black) !important;
        text-transform: uppercase !important;
        letter-spacing: -1px !important;
      }
      
      .kpi-label {
        font-family: var(--neo-font-primary) !important;
        font-weight: 700 !important;
        font-size: 12px !important;
        color: var(--neo-black) !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
      }
      
      .kpi-icon {
        color: var(--neo-black) !important;
        font-size: 1.8rem !important;
      }
      
      body{font-family:var(--neo-font-primary);font-weight:900;line-height:1.2;background:var(--neo-white);color:var(--neo-black)}.neo-container{max-width:1200px;margin:0 auto;padding:var(--neo-space-lg);contain:layout}.neo-header{margin-bottom:var(--neo-space-xl)}.neo-title{font-size:clamp(24px,4vw,48px);font-weight:900;text-align:center;background:var(--neo-white);color:var(--neo-black);border:var(--neo-border-thick);box-shadow:var(--neo-shadow-lg);padding:var(--neo-space-lg);position:relative;transform:rotate(-1deg);contain:layout style paint}.neo-nav{display:flex;justify-content:center;gap:var(--neo-space-lg);margin-bottom:var(--neo-space-xl);contain:layout}.neo-nav a{background:var(--neo-white);color:var(--neo-black);border:var(--neo-border-thick);padding:12px var(--neo-space-lg);text-decoration:none;font-weight:900;font-size:14px;text-transform:uppercase;letter-spacing:0.5px}.neo-button{background:var(--neo-red);color:var(--neo-black);border:var(--neo-border-thick);box-shadow:var(--neo-shadow-md);font-family:var(--neo-font-primary);font-weight:900;font-size:16px;text-transform:uppercase;letter-spacing:0.5px;padding:12px var(--neo-space-lg);cursor:pointer;contain:layout style paint}.neo-card{background:var(--neo-white);border:var(--neo-border-thick);box-shadow:var(--neo-shadow-md);padding:var(--neo-space-lg);margin-bottom:var(--neo-space-xl);position:relative;contain:layout style paint}@media (max-width:768px){.neo-nav{flex-direction:column;gap:8px}.neo-title{font-size:24px;transform:none}}
    </style>
    
    <!-- Preload critical scripts -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js" as="script">
    
    <!-- Load non-critical CSS asynchronously -->
    <link rel="preload" href="style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="style.css"></noscript>
    
    <link rel="preload" href="css/neo-brutalism.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/neo-brutalism.css"></noscript>
    
    <!-- Chart.js loaded with defer for better performance -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    
    <!-- Icons loaded with lower priority -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></noscript>
</head>
<body>
    <div class="olap-container">
        <header class="olap-header">
            <h1><i class="fas fa-users"></i> Virtual Peoples - Analysis Dashboard</h1>
            <nav>
                <a href="generate.html"><i class="fas fa-plus-circle"></i> Generate People</a>
                <a href="search.html" class="active"><i class="fas fa-chart-line"></i> Analytics</a>
            </nav>
        </header>

        <div class="olap-layout">
            <!-- 좌측 슬라이서 패널 -->
            <aside class="slicer-panel">
                <div class="panel-header">
                    <h3><i class="fas fa-sliders-h"></i> 다차원 필터</h3>
                    <div class="panel-controls">
                        <button id="clearFilters" class="neo-button neo-button--secondary" title="필터 초기화">
                            <i class="fas fa-times"></i>
                        </button>
                        <button id="applyFilters" class="neo-button" title="필터 적용">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <div class="slicer-group">
                    <div class="slicer-section collapsed">
                        <div class="slicer-header" data-target="demographics">
                            <i class="fas fa-user"></i>
                            <span>인구 통계학적 특성</span>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="slicer-content" id="demographics">
                            <div class="filter-item">
                                <label>나이 범위</label>
                                <div class="range-inputs">
                                    <input type="number" id="search_age_min" placeholder="최소" class="range-input">
                                    <span>~</span>
                                    <input type="number" id="search_age_max" placeholder="최대" class="range-input">
                                </div>
                            </div>
                            <div class="filter-item">
                                <label>성별</label>
                                <div class="checkbox-group" id="genderSlicer">
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="남성"> 남성
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="여성"> 여성
                                    </label>
                                </div>
                            </div>
                            <div class="filter-item">
                                <label>지역</label>
                                <input type="text" id="search_location" placeholder="지역명 입력" class="text-input">
                            </div>
                            <div class="filter-item">
                                <label>직업</label>
                                <input type="text" id="search_occupation" placeholder="직업명 입력" class="text-input">
                            </div>
                        </div>
                    </div>

                    <div class="slicer-section collapsed">
                        <div class="slicer-header" data-target="education">
                            <i class="fas fa-graduation-cap"></i>
                            <span>교육 & 경제적 특성</span>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="slicer-content" id="education">
                            <div class="filter-item">
                                <label>교육 수준</label>
                                <div class="checkbox-group" id="educationSlicer">
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="초졸"> 초졸
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="중졸"> 중졸
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="고졸"> 고졸
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="대졸"> 대졸
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="대학원졸"> 대학원졸
                                    </label>
                                </div>
                            </div>
                            <div class="filter-item">
                                <label>소득 분위</label>
                                <div class="checkbox-group" id="incomeSlicer">
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="하위 20%"> 하위 20%
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="20-40%"> 20-40%
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="40-60%"> 40-60%
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="60-80%"> 60-80%
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="상위 20%"> 상위 20%
                                    </label>
                                </div>
                            </div>
                            <div class="filter-item">
                                <label>결혼 상태</label>
                                <div class="checkbox-group" id="maritalSlicer">
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="미혼"> 미혼
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="기혼"> 기혼
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="이혼"> 이혼
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" value="사별"> 사별
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="slicer-section collapsed">
                        <div class="slicer-header" data-target="psychographic">
                            <i class="fas fa-brain"></i>
                            <span>심리 통계학적 특성</span>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="slicer-content" id="psychographic">
                            <div class="filter-item">
                                <label>관심사</label>
                                <input type="text" id="search_interests" placeholder="관심사 검색" class="text-input">
                            </div>
                            <div class="filter-item">
                                <label>가치관</label>
                                <input type="text" id="search_value" placeholder="가치관 검색" class="text-input">
                            </div>
                            <div class="filter-item">
                                <label>라이프스타일</label>
                                <input type="text" id="search_lifestyle_attribute" placeholder="라이프스타일 검색" class="text-input">
                            </div>
                            <div class="filter-item">
                                <label>성격 특성</label>
                                <input type="text" id="search_personality_trait" placeholder="성격 특성 검색" class="text-input">
                            </div>
                        </div>
                    </div>

                    <div class="slicer-section collapsed">
                        <div class="slicer-header" data-target="behavioral">
                            <i class="fas fa-shopping-cart"></i>
                            <span>행동 패턴</span>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="slicer-content" id="behavioral">
                            <div class="filter-item">
                                <label>미디어 소비</label>
                                <input type="text" id="search_media_consumption" placeholder="미디어 소비 패턴" class="text-input">
                            </div>
                            <div class="filter-item">
                                <label>쇼핑 습관</label>
                                <input type="text" id="search_shopping_habit" placeholder="쇼핑 습관" class="text-input">
                            </div>
                            <div class="filter-item">
                                <label>사회적 관계</label>
                                <input type="text" id="search_social_relations" placeholder="사회적 관계" class="text-input">
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 메인 분석 영역 -->
            <main class="analysis-main">
                <!-- 상단 KPI 카드 -->
                <section class="kpi-section">
                    <div class="kpi-card">
                        <div class="kpi-value" id="totalPersonas">0</div>
                        <div class="kpi-label">Total Virtual People</div>
                        <div class="kpi-icon"><i class="fas fa-users"></i></div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="avgAge">0</div>
                        <div class="kpi-label">Average Age</div>
                        <div class="kpi-icon"><i class="fas fa-birthday-cake"></i></div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="topLocation">-</div>
                        <div class="kpi-label">Top Location</div>
                        <div class="kpi-icon"><i class="fas fa-map-marker-alt"></i></div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="genderRatio">0:0</div>
                        <div class="kpi-label">Gender Ratio</div>
                        <div class="kpi-icon"><i class="fas fa-venus-mars"></i></div>
                    </div>
                </section>

                <!-- 다차원 분석 차트 -->
                <section class="chart-section">
                    <div class="chart-tabs">
                        <button class="tab-button active" data-tab="overview">Overview</button>
                        <button class="tab-button" data-tab="demographics">Demographics</button>
                        <button class="tab-button" data-tab="psychographics">Psychographics</button>
                        <button class="tab-button" data-tab="behavior">Behavior</button>
                    </div>

                    <div class="tab-content active" id="overview">
                        <div class="chart-grid-4">
                            <div class="chart-card">
                                <h4>Age Distribution</h4>
                                <canvas id="ageChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4>Gender Distribution</h4>
                                <canvas id="genderChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4>Location Distribution</h4>
                                <canvas id="locationChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4>Occupation Distribution</h4>
                                <canvas id="occupationChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="demographics">
                        <div class="chart-grid-2">
                            <div class="chart-card">
                                <h4>Education Level</h4>
                                <canvas id="educationChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4>Income Distribution</h4>
                                <canvas id="incomeChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4>Marital Status</h4>
                                <canvas id="maritalChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4>Age-Education Matrix</h4>
                                <canvas id="ageEducationChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="psychographics">
                        <div class="chart-grid-2">
                            <div class="chart-card">
                                <h4>Interests Cloud</h4>
                                <div id="interestsWordcloud" class="wordcloud-container"></div>
                            </div>
                            <div class="chart-card">
                                <h4>Values Analysis</h4>
                                <div id="valuesWordcloud" class="wordcloud-container"></div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="behavior">
                        <div class="chart-grid-2">
                            <div class="chart-card">
                                <h4>Media Consumption</h4>
                                <canvas id="mediaChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4>Shopping Habits</h4>
                                <canvas id="shoppingChart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h4>Social Relations</h4>
                                <div id="socialWordcloud" class="wordcloud-container"></div>
                            </div>
                            <div class="chart-card">
                                <h4>Lifestyle Traits</h4>
                                <div id="lifestyleWordcloud" class="wordcloud-container"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Pivot Table -->
                <section class="pivot-section">
                    <div class="section-header">
                        <h3><i class="fas fa-table"></i> Pivot Table</h3>
                        <div class="pivot-controls">
                            <select id="pivotRows" class="pivot-select">
                                <option value="age_group">Age Group</option>
                                <option value="gender">Gender</option>
                                <option value="location">Location</option>
                                <option value="education">Education</option>
                                <option value="occupation">Occupation</option>
                            </select>
                            <span>×</span>
                            <select id="pivotCols" class="pivot-select">
                                <option value="gender">Gender</option>
                                <option value="education">Education</option>
                                <option value="income_bracket">Income</option>
                                <option value="marital_status">Marital Status</option>
                            </select>
                            <button id="generatePivot" class="neo-button">
                                <i class="fas fa-sync-alt"></i> GENERATE
                            </button>
                        </div>
                    </div>
                    <div id="pivotTable" class="pivot-table-container"></div>
                </section>

                <!-- Detailed Data Grid -->
                <section class="data-grid-section">
                    <div class="section-header">
                        <h3><i class="fas fa-list"></i> Detailed Data</h3>
                        <div class="grid-controls">
                            <span class="result-count">Total <span id="resultCount">0</span> people</span>
                            <button id="exportBtn" class="neo-button neo-button--secondary">
                                <i class="fas fa-download"></i> EXPORT EXCEL
                            </button>
                        </div>
                    </div>
                    <div id="dataGrid" class="data-grid-container"></div>
                </section>
            </main>
        </div>

        <!-- Data Management Section -->
        <section class="management-section">
            <h3><i class="fas fa-database"></i> Data Management</h3>
            <button id="deleteAllBtn" class="neo-button neo-button--warning">
                <i class="fas fa-trash"></i> DELETE ALL VIRTUAL PEOPLE
            </button>
            <div id="deleteResult" class="result-box"></div>
        </section>
    </div>

    <script src="search_script.js"></script>
</body>
</html>
